<!DOCTYPE html>
<html>
<head>
  <meta charset="UTF-8">
  <title>Select Area</title>
  <style>
    * { margin: 0; padding: 0; box-sizing: border-box; }
    html, body {
      width: 100%; height: 100%;
      overflow: hidden;
      cursor: crosshair;
      user-select: none;
      background: rgba(0, 0, 0, 0.4);
    }
    
    #instructions {
      position: fixed;
      top: 50%; left: 50%;
      transform: translate(-50%, -50%);
      background: rgba(20, 20, 40, 0.95);
      color: white;
      padding: 24px 36px;
      border-radius: 12px;
      text-align: center;
      font-family: 'Segoe UI', sans-serif;
      border: 2px solid #e94560;
      z-index: 100;
    }
    #instructions h2 { color: #e94560; margin-bottom: 10px; }
    #instructions p { color: #aaa; font-size: 14px; }
    #instructions kbd {
      background: #333;
      padding: 3px 8px;
      border-radius: 4px;
      font-family: monospace;
    }
    
    /* Selection box with corner brackets */
    #selection {
      position: fixed;
      display: none;
      pointer-events: none;
    }
    #selection.active { display: block; }
    
    /* Corner brackets */
    .corner {
      position: absolute;
      width: 24px;
      height: 24px;
    }
    .corner.tl { top: -2px; left: -2px; border-top: 4px solid #e94560; border-left: 4px solid #e94560; }
    .corner.tr { top: -2px; right: -2px; border-top: 4px solid #e94560; border-right: 4px solid #e94560; }
    .corner.bl { bottom: -2px; left: -2px; border-bottom: 4px solid #e94560; border-left: 4px solid #e94560; }
    .corner.br { bottom: -2px; right: -2px; border-bottom: 4px solid #e94560; border-right: 4px solid #e94560; }
    
    /* Dashed border between corners */
    .edge {
      position: absolute;
      border: 1px dashed rgba(233, 69, 96, 0.6);
    }
    .edge.top { top: 0; left: 24px; right: 24px; height: 0; }
    .edge.bottom { bottom: 0; left: 24px; right: 24px; height: 0; }
    .edge.left { left: 0; top: 24px; bottom: 24px; width: 0; }
    .edge.right { right: 0; top: 24px; bottom: 24px; width: 0; }
    
    /* Clear area in selection */
    #selection::before {
      content: '';
      position: absolute;
      top: 2px; left: 2px; right: 2px; bottom: 2px;
      background: rgba(233, 69, 96, 0.05);
    }
    
    /* Dimension label */
    #dimensions {
      position: fixed;
      display: none;
      background: #e94560;
      color: white;
      padding: 6px 14px;
      border-radius: 4px;
      font-family: 'Segoe UI', sans-serif;
      font-size: 14px;
      font-weight: 600;
      pointer-events: none;
      z-index: 200;
    }
    #dimensions.active { display: block; }
    
    /* Confirm buttons */
    #buttons {
      position: fixed;
      display: none;
      gap: 12px;
      z-index: 200;
    }
    #buttons.active { display: flex; }
    #buttons button {
      padding: 10px 28px;
      border: none;
      border-radius: 6px;
      font-size: 14px;
      font-weight: 600;
      cursor: pointer;
      font-family: 'Segoe UI', sans-serif;
    }
    #confirmBtn { background: #e94560; color: white; }
    #confirmBtn:hover { background: #ff6b6b; }
    #cancelBtn { background: #333; color: white; border: 1px solid #555; }
    #cancelBtn:hover { background: #444; }
  </style>
</head>
<body>
  <div id="instructions">
    <h2>üìê Select Recording Area</h2>
    <p>Click and drag to select the area</p>
    <p style="margin-top: 8px;">Press <kbd>ESC</kbd> to cancel</p>
  </div>
  
  <div id="selection">
    <div class="corner tl"></div>
    <div class="corner tr"></div>
    <div class="corner bl"></div>
    <div class="corner br"></div>
    <div class="edge top"></div>
    <div class="edge bottom"></div>
    <div class="edge left"></div>
    <div class="edge right"></div>
  </div>
  
  <div id="dimensions"></div>
  
  <div id="buttons">
    <button id="confirmBtn">‚úì Confirm</button>
    <button id="cancelBtn">‚úï Cancel</button>
  </div>

  <script>
    var { ipcRenderer } = require('electron');
    
    var instructions = document.getElementById('instructions');
    var selection = document.getElementById('selection');
    var dimensions = document.getElementById('dimensions');
    var buttons = document.getElementById('buttons');
    var confirmBtn = document.getElementById('confirmBtn');
    var cancelBtn = document.getElementById('cancelBtn');
    
    var drawing = false;
    var done = false;
    var startX = 0, startY = 0;
    var rect = { x: 0, y: 0, w: 0, h: 0 };
    
    document.onmousedown = function(e) {
      if (done) return;
      drawing = true;
      startX = e.clientX;
      startY = e.clientY;
      instructions.style.display = 'none';
      selection.classList.add('active');
      dimensions.classList.add('active');
    };
    
    document.onmousemove = function(e) {
      if (!drawing) return;
      
      var x = Math.min(startX, e.clientX);
      var y = Math.min(startY, e.clientY);
      var w = Math.abs(e.clientX - startX);
      var h = Math.abs(e.clientY - startY);
      
      rect = { x: x, y: y, w: w, h: h };
      
      selection.style.left = x + 'px';
      selection.style.top = y + 'px';
      selection.style.width = w + 'px';
      selection.style.height = h + 'px';
      
      dimensions.textContent = w + ' √ó ' + h;
      dimensions.style.left = (x + w/2 - 40) + 'px';
      dimensions.style.top = (y - 35) + 'px';
    };
    
    document.onmouseup = function(e) {
      if (!drawing) return;
      drawing = false;
      
      if (rect.w > 30 && rect.h > 30) {
        done = true;
        buttons.classList.add('active');
        buttons.style.left = (rect.x + rect.w/2 - 80) + 'px';
        buttons.style.top = (rect.y + rect.h + 15) + 'px';
      } else {
        selection.classList.remove('active');
        dimensions.classList.remove('active');
        instructions.style.display = 'block';
      }
    };
    
    confirmBtn.onclick = function() {
      ipcRenderer.send('area-selected', {
        x: Math.round(rect.x),
        y: Math.round(rect.y),
        width: Math.round(rect.w),
        height: Math.round(rect.h)
      });
    };
    
    cancelBtn.onclick = function() {
      ipcRenderer.send('cancel-selection');
    };
    
    document.onkeydown = function(e) {
      if (e.key === 'Escape') {
        ipcRenderer.send('cancel-selection');
      }
    };
  </script>
</body>
</html>
